# 02장.컴퓨터 시스템의 구조 - 04

cpu는 매 순간 기계어를 하나씩 실행한 다음, 인터럽트가 들어오면 프로그램 카운터가 메모리의 운영체제 위치를 가리키도록 되어있다. 그 후 운영체제 코드가 실행될 때(cpu의 제어권이 os로 넘어감)는 mode bit을 0으로 바뀌어서 모든 기계어를 다 실행할 수 있게한다. 이후에 os가 cpu를 다른 곳에 넘겨줄 때는 mode bit을 1로 바꾸어서 제한된 기계어만 실행되도록 한다.

<br>

## 시스템 콜(System Call)

- 사용자 프로그램 실행 중 파일을 읽어와야할 때는 cpu가 직접 디스크에 접근할 수 없으므로(특권 명령이기 떄문), 디스크 전담 컨트롤러에게 부탁을 한다.(모든 I/O 실행)
- 사용자 프로그램이 OS의 서비스를 받기 위해 커널 함수를 호출한다.
- 사용자 프로그램이 OS에게 cpu를 넘기기 위해서 스스로 인터럽트를 호출하고, 제어권이 OS에게 넘어간다.
- 디스크가 작업을 하는 동안 OS가 사용자 프로그램에게 cpu를 넘기는 것이 아니고 다른 프로그램에게 cpu를 넘기게 된다. 디스크 작업이 끝나면 인터럽트를 걸게 되고 다시 cpu가 OS에게 넘어간다. OS는 아까 요청했던 사용자 프로그램에게 읽어온 파일을 복사해주고 그 프로그램은 cpu를 얻으면 바로 기계어를 실행할 수 있게 된다.

<br>

## 인터럽트 (Interrupt)

- 현대 운영체제는 인터럽트에 의해 구동됨
- 인터럽트를 당한 시점의 레지스터와 program counter를 저장한 후 cpu의 제어를 인터럽트 처리 루틴에 넘긴다.
- 넓은 의미
    - Interrupt (하드웨어 인터럽트) : 하드웨어가 발생시킨 인터럽트
    - Trap (소프트웨어 인터럽트) : Exception(프로그램 오류), System Call(프로그램이 커널 함수 호출)
- 인터럽트 벡터 : 해당 인터럽트의 처리 루틴 주소를 가지고 있음. 인터럽트 종류별로 실행해야 될 코드를 위치를 가지고 있는 것.
- 인터럽트 처리 루틴 (=인터럽트 핸들러) : 해당 인터럽트를 처리하는 커널 함수. 인터럽트 종류별로 실행해야될 코드

<br>

## 동기식/비동기식 입출력

두 경우 모두 I/O의 완료는 인터럽트로 알려줌

1) 동기식 입출력 (synchronous I/O)

- I/O 요청 후 입출력 작업이 완료된 후에야 제어가 사용자 프로그램에 넘어감

2) 비동기식 입출력 (asynchronous I/O)

- I/O가 시작된 후 입출력 작업이 끝나기를 기다리지 않고 제어가 사용자 프로그램에 즉시 넘어감

<br>

## DMA Controller (Direct Memory Access)

- 인터럽트가 너무 자주 일어나는 것을 막기 위한 것 (cpu만이 메모리에 직접 접근할 수 있기 때문에 인터럽트가 너무 자주 발생할 수 있음 → 메모리에 직접 접근할 수 있는 장치를 더 두자.)
- 입출력 장치를 메모리에 가까운 속도로 처리하기 위해 사용
- cpu의 중재 없이 device controller가 device의 버퍼 저장소의 내용을 메모리에 블록 단위로 직접 전송
- 바이트 단위가 아니라 블록 단위로 인터럽트를 발생시키므로 인터럽트가 자주 일어나는 것을 막을 수 있음

<br>

## 서로 다른 입출력 기계어

I/O를 수행하는 기계어는 두가지 방법이 있음

- I/O를 수행하는 전담 기계어를 두는 방법 (메모리 접근 기계어 , I/O 수행하는 기계어 따로)
- Memory Mapped I/O에 의한 방법 : 메모리 주소를 I/O 장치에도 주소를 연장해서 매긴 다음, 메모리 접근 기계어를 통해서 I/O를 접근하는 방법