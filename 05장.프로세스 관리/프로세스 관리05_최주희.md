# 05장.프로세스 관리 - 05

## 프로세스 생성

운영체제가 프로세스 전부를 생성하는 것은 아니고 최초의 프로세스 이후는 이미 존재하는 프로세스가 다른 프로세스를 복제 생성함  

- 부모 프로세스가 자식 프로세스 생성
- 프로세스의 트리 구조 형성
- 프로세스는 자원을 필요로 함
    - 운영체제로부터 받음
    - 부모와 공유
- 자원의 공유
    - 부모와 자식이 모든 자원을 공유하는 모델
    - 일부를 공유하는 모델
    - 전혀 공유하지 않는 모델
- 수행
    - 부모와 자식은 공존하며 수행되는 모델
    - 자식이 종료(terminate) 될때까지 부모가 기다리는(wait) 모델
- 주소 공간
    - 자식은 부모의 공간을 복사함 (binary and OS data)
    - 자식은 그 공간에 새로운 프로그램을 올림
- 유닉스의 예
    - fork() 시스템 콜이 새로운 프로세스를 생성 : 부모를 그대로 복사하고 주소 공간 할당
    - fork() 다음에 이어지는 exec() 시스템 콜을 통해 새로운 프로그램을 메모리에 올림
    

<br>

## 프로세스 종료

- exit() : 프로세스가 마지막 명령 수행 후 운영체제에게 이를 알려줌
    - 자발적 종료
    - 자식이 부모에게 output data를 보냄(wait을 통해)
    - 프로세스의 각종 자원들이 os에게 반납됨
- abort() : 부모 프로세스가 자식의 수행을 종료시킴
    - 비자발적 종료, 강제 종료
    - 자식이 할당 자원의 한계치를 넘어서는 많은 양의 자원을 요구할 때
    - 자식에게 할당된 작업이 더이상 필요하지 않을 때
    - 부모가 종료될 때 : os가 자식 프로세스가 더이상 수행되지 못하게 하기 때문에 단계적 종료 수행. 자식 프로세스를 다 죽인 후에 부모 프로세스를 죽인다.
    

<br>

## fork()와 exec()

- 자식 프로세스는 부모 프로세스의 처음부터 수행을 시작하는 것이 아니라 부모프로세스가 현재 수행한 시점(프로그램 카운터 지점)부터 수행
- 자신이 복제본인지 원본인지 구별할 수 있게 하기 위하여 fork()의 결과값으로 원본에게는 양수, 복제본에게는 0을 준다. 이를 이용하여 각자 다른 작업 수행
- 자식은 exec()를 통해 지금까지 수행했던 상태를 잊어버리고 그 주소 공간을 완전히 새로운 프로그램으로 덮어씌운 후 새로운 프로그램의 첫 부분부터 다시 실행하도록 함

```cpp
int main() { 
	int pid;
	pid = fork();
	if(pid == 0) {  //자식 프로세스
		printf("\n Hello, I am child!\n");
		execlp("/bin/date", "/bin/date", (char *));
	}
	else if (pid > 0) {  //부모 프로세스
		printf("\n Hello, I am parent!\n");
	}
}
```

<br>

## wait()

- 자식 프로세스가 종료되기를 기다리며 부모 프로세스가 봉쇄상태에 머무르도록 할 때 사용
- fork() 이후에 wait()를 호출하면 커널은 자식 프로세스가 종료될 때까지 부모 프로세스를 봉쇄 상태로 머무르게 한 후에, 자식이 종료되면 부모를 준비 상태로 변경시켜 작업 재개 → 부모와 자식간의 동기화

<br>

## exit()

- 자발적 종료 : 명시하지 않아도 프로그램이 종료될 때 컴파일러가 넣어서 종료시킴
- 강제 종료
    - 부모 프로세스가 자식 프로세스를 강제 종료
    - kill, break
    - 부모가 종료되는 경우
    

<br>

## 프로세스 간 협력

- 독립적 프로세스 : 프로세스는 각자 주소 공간을 가지고 수행되므로 원칙적으로 하나의 프로세스는 다른 프로세스의 수행에 영향을 미치지 못함
- 협력 프로세스
    - 프로세스 협력 메커니즘을 통해 하나의 프로세스가 다른 프로세스의 수행에 영향을 미칠 수 있게 함
    - ex) 프로세스 간 협력 메커니즘 IPC(인터프로세스 커뮤니케이션)
        - 메세지 전달 방법 : message passing (커널을 통해 메세지 전달)
        - 주소 공간 공유 방법 : shared memory (서로 다른 프로세스 간에도 일부 주소공간을 공유하게하는 메커니즘) → 동기화 문제 책임져야함